<h1 id="logical-operators">Logical operators</h1>
<!--
Part of the Carbon Language project, under the Apache License v2.0 with LLVM
Exceptions. See /LICENSE for license information.
SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
-->

<!-- toc -->

<h2 id="table-of-contents">Table of contents</h2>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#details">Details</a>
<ul>
<li><a href="#precedence">Precedence</a></li>
<li><a href="#associativity">Associativity</a></li>
<li><a href="#conversions">Conversions</a></li>
<li><a href="#overloading">Overloading</a></li>
</ul></li>
<li><a href="#alternatives-considered">Alternatives considered</a></li>
<li><a href="#references">References</a></li>
</ul>
<!-- tocstop -->

<h2 id="overview">Overview</h2>
<p>Carbon provides three operators to support logical operations on <code>bool</code> values:</p>
<ul>
<li><code>and</code> provides a logical AND operation.
<ul>
<li><code>x and y</code> evaluates to <code>true</code> if both operands are <code>true</code>.</li>
</ul></li>
<li><code>or</code> provides a logical OR operation.
<ul>
<li><code>x or y</code> evaluates to <code>true</code> if either operand is <code>true</code>.</li>
</ul></li>
<li><code>not</code> provides a logical NOT operation.
<ul>
<li><code>not x</code> evaluates to <code>true</code> if the operand is <code>false</code>.</li>
</ul></li>
</ul>
<p><code>and</code> and <code>or</code> are infix binary operators, and use <a href="https://en.wikipedia.org/wiki/Short-circuit_evaluation">short-circuit evaluation</a>. <code>not</code> is a prefix unary operator.</p>
<h2 id="details">Details</h2>
<h3 id="precedence">Precedence</h3>
<p><code>and</code> and <code>or</code> have very low precedence. When an expression appearing as the condition of an <code>if</code> uses these operators unparenthesized, they are always the lowest precedence operators in that expression.</p>
<p>These operators permit any reasonable operator that might be used to form a <code>bool</code> value as a subexpression. In particular, comparison operators such as <code>&lt;</code> and <code>==</code> have higher precedence than <code>and</code> and <code>or</code>. However, the precedence of <code>and</code> and <code>or</code> is not directly comparable with each other, so they cannot both be used directly in an expression without parentheses.</p>
<p><code>not</code> is higher precedence than <code>and</code> and <code>or</code>, but its precedence is incomparable with most other operators, including comparison operators.</p>
<p>For example:</p>
<pre class="carbon"><code>// ✅ Valid: `and` is lower precedence than the `&lt;` or `==` operators.
if (n + m == 3 and not n &lt; m) {
  ...
}
// The above is equivalent to:
if (((n + m) == 3) and (not (n &lt; m))) {
  ...
}

// ❌ Invalid: `and` and `or` precedence is incomparable.
if (cond1 and cond2 or cond3) {
  ...
}
// ✅ Valid: Parentheses avoid the precedence check.
if (cond1 and (cond2 or cond3)) {
  ...
}

// ❌  Invalid: `not` precedence is incomparable with `==`.
if (not cond1 == cond2) {
  ...
}
// ❌  Invalid: `not` precedence is incomparable with `==`.
if (cond1 == not cond2) {
  ...
}
// ✅ Valid: Parentheses avoid the precedence check.
if (cond1 == (not cond2)) {
  ...
}</code></pre>
<h3 id="associativity">Associativity</h3>
<p><code>and</code> and <code>or</code> are left-associative. A <code>not</code> expression cannot be the operand of another <code>not</code> expression; <code>not not b</code> is an error without parentheses.</p>
<pre><code>// ✅ Valid: `and` is left-associative, and precedence is fine.
if (not a and not b and not c) {
  ...
}
// The above is equivalent to:
if ((not a) and ((not b) and (not c))) {
  ...
}
// ✅ Valid: Parentheses avoid the `not` associativity error.
if (not (not a)) {
  ...
}

// ❌ Invalid: `not not` associativity requires parentheses.
if (not not a) {
  ...
}</code></pre>
<h3 id="conversions">Conversions</h3>
<blockquote>
<p>TODO: This should be addressed through a standard <code>bool</code> conversion design.</p>
</blockquote>
<p>The operand of <code>and</code>, <code>or</code>, or <code>not</code> is converted to a <code>bool</code> value in the same way as the condition of an <code>if</code> statement. In particular:</p>
<ul>
<li>If we decide that certain values, such as pointers or integers, should not be usable as the condition of an <code>if</code> without an explicit comparison against null or zero, then those values will also not be usable as the operand of <code>and</code>, <code>or</code>, or <code>not</code> without an explicit comparison.</li>
<li>If an extension point is provided to determine how to branch on the truth of a value in an <code>if</code> (such as by supplying a conversion to a <code>bool</code> type), that extension point will also apply to <code>and</code>, <code>or</code>, and <code>not</code>.</li>
</ul>
<h3 id="overloading">Overloading</h3>
<p>The logical operators <code>and</code>, <code>or</code>, and <code>not</code> are not overloadable. As noted above, any mechanism that allows types to customize how <code>if</code> treats them will also customize how <code>and</code>, <code>or</code>, and <code>not</code> treats them.</p>
<h2 id="alternatives-considered">Alternatives considered</h2>
<ul>
<li><a href="https://github.com/carbon-language/carbon-lang/tree/trunk/proposals/p0680.md#use-punctuation-spelling-for-all-three-operators">Use punctuation spelling for all three operators</a></li>
<li><a href="https://github.com/carbon-language/carbon-lang/tree/trunk/proposals/p0680.md#precedence-of-and-versus-or">Precedence of AND versus OR</a></li>
<li><a href="https://github.com/carbon-language/carbon-lang/tree/trunk/proposals/p0680.md#precedence-of-not">Precedence of NOT</a></li>
<li><a href="https://github.com/carbon-language/carbon-lang/tree/trunk/proposals/p0680.md#punctuation-form-of-not">Punctuation form of NOT</a></li>
<li><a href="https://github.com/carbon-language/carbon-lang/tree/trunk/proposals/p0680.md#two-forms-of-not">Two forms of NOT</a></li>
<li><a href="https://github.com/carbon-language/carbon-lang/tree/trunk/proposals/p0680.md#repeated-not">Repeated NOT</a></li>
<li><a href="https://github.com/carbon-language/carbon-lang/tree/trunk/proposals/p0680.md#and-and-or-produce-the-decisive-value">AND and OR produce the decisive value</a></li>
</ul>
<h2 id="references">References</h2>
<ul>
<li>Proposal <a href="https://github.com/carbon-language/carbon-lang/pull/680">#680: And, or, not</a>.</li>
<li>Proposal <a href="https://github.com/carbon-language/carbon-lang/pull/702">#702: Comparison operators</a>.</li>
</ul>
